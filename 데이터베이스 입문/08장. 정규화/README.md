# 08장. 정규화

# 1. 정규화와 이상 현상

## 1. 정규화의 필요성

- 정규화 : 좋은 릴레이션 스키마를 설계하도록 하는 절차적 방법
- 데이터 중복을 최소화하는 형태로 릴레이션 스키마 정의 → 부작용 감소

## 2. 이상 현상

- 데이터 이상(Data Anomaly) : 릴레이션 처리 과정에서 불필요한 데이터 중복으로 인해 발생하는 부작용
- 릴레이션 안에 데이터를 입력, 수정, 삭제하려고 할 때 의도하지 않은 문제점이 발생하거나 불필요한 작업을 추가 수행해야 하는 곤란한 상황
- 삽입 이상(Insertion Anomaly) : 불필요한 데이터를 함께 입력하지 않고서는 원하는 데이터만 입력이 불가능한 상황
- 갱신 이상(Update Anomaly) : 중복된 속성 값 중 일부가 수정되지 않아 데이터 불일치가 일어나는 상황
- 삭제 이상(Deletion Anomaly) : 삭제할 때 원하지 않는 유용한 데이터까지 함께 삭제되어 데이터 손실이 발생하는 상황

## 3. 정규화의 개념

- 데이터 이상 방지를 위해 중복을 감소시키는 구조로 단계적 규칙에 따라 릴레이션을 분해하는 과정
- 잘못된 설계를 바로 잡는 과정

# 2. 함수 종속성

## 1. 함수 종속성(FD, Functional Dependency) 정의

- 같은 릴레이션 안의 속성 간에 특정 속성 값이 함수적으로 다른 속성 값을 결정하는 종속 관계
- 결정자(Determinant) : 어떤 속성 값이 다른 속성 값을 고유하게 결정하는 것
- 종속자(Dependent) : 속성 값이 고유하게 결정된 것
- 릴레이션의 모든 가능한 인스턴스에 대해서 충족

## 2. 함수 종속 다이어그램(FD Diagram)

- 하나의 릴레이션을 구성하는 속성들 간의 복잡한 함수 종속 관계를 이해하기 쉽도록 표현한 그림
- 릴레이션 속성 : 사각형
- 속성 간의 함수 종속성 : 화살표
- 완전 함수 종속(Full Functional Dependency) : 특정 속성이 결정자인 둘 이상의 전체 속성 조합에는 함수 종속이면서 결정자의 어떤 일부 속성에도 함수 종속이 아닌 것
- 부분 함수 종속(Partial Fucntional Dependency) : 특정 속성이 결정자인 둘 이상의 전체 속성 조합에도 함수 종속이면서 결정자의 일부 속성에도 함수 종속인 것

# 3. 기본 졍규형

## 1. 정규형의 종류

- 정규형(NF, Normal Form) : 정규화 과정에서 릴레이션이 만족해야 하는 특정한 함수 종속성의 충족 조건

## 2. 제1정규형(1NF)

- 제1정규형 정의

    <aside>
    💡 어떤 릴레이션 R에 속한 모든 속성의 도메인이 원자 값만을 가짐

    </aside>

- 제1정규형 문제점
    - 삽입 이상 : 기본키 제약 조건 위배
    - 수정 이상 : 일부만 변경할 경우 갱신 불일치 문제 원인
    - 삭제 이상 : 원하지 않은 정보까지 데이터베이스에서 함께 삭제
- 제1정규형 문제점 해결
    - 릴레이션을 연관성이 높은 속성끼리 분해하여 부분 함수 종속성 제거
    - 무손실 분해(Nonloss Decomposition) : 정규화 과정에서 릴레이션 분해는 어떤 정보도 손실되지 않게 동등한 릴레이션들로 분해하는 것

## 3. 제2정규형(2NF)

- 제2정규형 정의

    <aside>
    💡 어떤 릴레이션 R이 제1정규형이고 기본키에 속하지 않는 모든 속성이 기본키에 완전 함수 종속인 것

    </aside>

- 제2정규형 문제점
    - 삽입 이상 : 기본키 제약 조건 위배
    - 수정 이상 : 속성 값이 불필요하게 여러 번 중복 저장
    - 삭제 이상 : 원하지 않는 정보까지 함께 삭제 → 데이터베이스에서 완전히 사라짐
- 제2정규형 문제점 해결
    - 이행적 함수 종속성(Transitive Functional Dependency) : 기본키에 속하지 않은 일반 속성 값이 기본키에 속하지 않은 또 다른 일반 속성 값을 결정함
    - 이행적 종속 관계를 끊어 두 종속 관계를 각각 다른 릴레이션에 표현 → 2개의 릴레이션으로 분해

## 4. 제3정규형(3NF)

- 제3정규형 의미

    <aside>
    💡 어떤 릴레이션 R이 제2정규형이고 기본키에 속하지 않는 모든 속성이 기본키에 이행적 함수 종속이 아닌 것

    </aside>

- 제3정규형 문제점
    - 삽입 이상 : 기본키 제약 조건 위배
    - 수정 이상 : 속성 값이 불필요하게 여러 번 중복되어 발생 → 갱신 불일치
    - 삭제 이상 : 데이터베이스에서 완전히 사라짐
- 제3정규형 문제점 해결
    - 기본키가 아닌 결정자 분리

## 5. 보이스코드 정규형(BCNF, Boyce Codd Normal Form)

- 보이스코드 정규형 정의

    <aside>
    💡 릴레이션 R의 모든 결정자가 후보키인 것

    </aside>

- 보이스코드 정규형 문제점 : 기본키 속성이 기본키 속성이 아닌 일반 속성에 종속적
- 보이스코드 정규형 문제점 해결 : 모든 결정자를 후보키로 제작

## 6. 정규화의 적용

- 비정규 릴레이션
    - 반복되는 속성 및 그룹 속성 제거
- 1NF
    - 부분 함수 종속성 제거
- 2NF
    - 이행 함수 종속성 제거
- 3NF
    - 결정자가 후보키가 아닌 함수 종속성(FD) 제거
- BCNF
    - 함수 종속이 아닌 다중값 종속성(MVD) 제거
- 4NF
    - 후보키를 통하지 않는 조인 종속성(JD) 제거
- 5NF

## 7. 고급 정규형

- 제4정규형 : 결정자가 특정 속성 값 하나가 아니라 여러 개의 값 집합을 결정하는 다치 종속성 충족 조건 이용
- 제5정규형 : 릴레이션이 특정 프로젝트들의 조인 결과와 똑같도록 하는 조인 종속 충족 조건 이용

## 8. 반정규화(De-normalization)

- 정규화의 반대 개념, 역정규화
- 릴레이션 병합
- 통계/이력 릴레이션 추가
- 여러 릴레이션에 같은 속성을 중복하여 추가
- 총계/평균 같은 파생 속성 추가