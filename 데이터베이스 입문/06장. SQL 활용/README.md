# 06장. SQL 활용

# 1. SQL 데이터 정의문

- 데이터베이스와 테이블 구조를 생성하는 명령문

## 1. 테이블 생성 CREATE문

- 데이터베이스/테이블 생성
- 테이블 이름, 열 이름, 데이터 유형, 널 허용 여부, 각종 무결성 제약 조건, 기본키, 외래키, 대체키 등의 제약 조건 정의
- 데이터베이스 생성 : `CREATE DATABASE 데이터베이스_이름;`
- 데이터베이스 삭제 : `DROP DATABASE 데이터베이스_이름;`

### 1. CREATE TABLE의 형식

```sql
CREATE TABLE 테이블_이름
  ({열_이름 데이터_유형 [NULL|NOT NULL] [DEFAULT 기본_값], }+
    [PRIMARY KEY (열_이름_리스트),]
   {[UNIQUE (열_이름_리스트),]}*
   {[FOREIGN KEY (열_이름_리스트) REFERENCES 테이블_이름 (열_이름_리스트),]}*
  );
```

- 테이블 이름 정의
- 테이블을 구성하는 열의 열_이름과 데이터_유형을 반복 정의
- `NOT NULL` : 널 값 입력 허용 여부 정의, 도메인 무결성 제약 조건 구현
- `DEFAULT` : 입력 값 생략 → 자동으로 입력될 기본_값 정의, 도메인 무결성 제약 조건 구현
- `PRIMARY KEY` : 기본키 정의, 개체 무결성 제약 조건 구현
- `UNIQUE` : 대체키(후보키) 정의, 유일성 제약 조건 구현
- `FOREIGN KEY` : 외래키 정의, 참조 무결성 제약 조건 구현
- 데이터 유형 - 문자형
    - CHAR(길이) : 고정길이 문자열, 남은 공간은 공백으로 채움
    - VARCHAR(길이) : 가변길이 문자열, 남은 공간이 없음
    - TEXT : 긴 문자열(255자 이상)
- 데이터 유형 - 정수형
    - INT : 소수점이 없는 기본 정수형
    - SMALLINT : 소수점이 없는 작은 정수형
- 데이터 유형 - 실수형
    - DECIMAL(전체길이, 소수점이하길이) : 고정 소수점을 포함한 실수
    - FLOAT(전체길이, 소수점이하길이) : 단정도 부동 소수점 실수
    - DOUBLE(전체길이, 소수점이하길이) : 배정도 부동 소수점 실수
- 데이터 유형 - 날짜형
    - DATE : 날짜(연도-월-일)
    - DATETIME : 날짜시간(연도-월-일 시:분:초)
    - TIME : 시간(시:분:초)
    - YEAR : 날짜(연도)

## 2. 테이블 수정 ALTER문

- 새로운 열/제약 조건 추가, 기존 열/제약 조건 변경 가능

### 1. ALTER TABLE문의 형식

```sql
ALTER TABLE 테이블_이름
  {[ADD|MODIFY] 열_이름 데이터_유형 [NULL|NOT NULL] [DEFAULT 기본_값]}
  |{ADD CONSTRAINT 제약조건_이름 제약조건_상세내용}
  |{DROP COLUMN 열_이름}
  |{DROP CONSTRAINT 제약조건_이름};
```

- 수정할 테이블_이름 명세
- `ADD` : 추가할 열 명세
- `DROP` : 이미 만들어진 기존 열 삭제
- 열 이름 변경 : `ALTER TABLE 테이블_이름 CHANGE 기존_열이름 새로운_열이름 기존_열_유형;`
- 테이블 이름 변경 : `ALTER TABLE 테이블_이름 RENAME TO 새로운_테이블_이름;`

## 3. 테이블 삭제 DROP문

- 생성된 테이블 삭제

### 1. DROP TABLE문의 형식

```sql
DROP TABLE 테이블_이름;
```

- 참조하는 테이블 존재 → 테이블 삭제 불가

# 2. SQL 데이터 제어문

## 1. 사용자 및 권한 관리

### 1. 계정 생성 : CREATE USER

- 각 사용자를 위한 계정 생성 가능

    ```sql
    CREATE USER 사용자_계정 IDENTIFIED BY '비밀번호';
    ```

    - 사용자_계정 : `아이디@접속_호스트`

### 2. 권한 부여 : GRANT

- 사용자_계정에 여러 권한 부여 가능

    ```sql
    GRANT 권한_내용 ON 권한_대상 TO 사용자_계정;
    
    GRANT 권한_내용 ON 권한_대상 TO 사용자_계정 WITH GRANT OPTION;
    ```

    - 권한_내용 : 데이터에 대한 입력, 수정, 삭제, 검색 권한
    - 권한_대상 : `데이터베이스이름.객체이름`
    - `WITH GRANT OPTION` : 부여받은 권한을 계정 사용자가 다른 사용자_계정에게도 부여 가능

### 3. 권한 철회 : REVOKE

- 부여한 권한 철회

    ```sql
    REVOKE 권한_내용 ON 권한_대상 FROM 사용자_계정;
    ```


### 4. 계정 삭제 : DROP USER

- 등록된 사용자 계정 삭제

    ```sql
    DROP USER 사용자_계정;
    ```


# 3. 뷰

## 1. 뷰 개념

- 데이터베이스를 바라보는 창문과 같음

### 1. 뷰(VIEW) 정의

- 실제 데이터를 저장하지 않는 가상 테이블(Virtual Table)
- SELECT문을 통한 검색 결과를 가상의 테이블로 정의하여 필요할 때만 실제 테이블처럼 사용하도록 만든 데이터베이스 객체

### 2. 뷰의 장점

- 편의성 : 복잡한 질의문 작성이 쉽고 간단해짐
- 보안성 : 데이터 보안 유지가 쉬움
- 재사용성 : 반복되는 질의문 작성 효율적
- 독립성 : 스키마 변경에도 뷰 질의문은 변경할 필요가 없음

## 2. 뷰 생성

### 1. CREATE VIEW문

```sql
CREATE VIEW 뷰_이름 [(열_리스트)]
AS SELECT_검색문;
```

- 뷰_이름 : 생성할 뷰의 이름
- SELECT_검색문 : 뷰 실체 정의

## 3. 뷰 활용

- 뷰를 통한 검색 가능 → 일반 테이블과 같은 방식으로 검색 가능
- 뷰를 통한 데이터 변경 : 특정한 경우로 한정

## 4. 뷰 삭제

```sql
DROP VIEW 뷰_이름;
```

- 뷰 기반 테이블 미삭제

# 4. 인덱스

## 1. 인덱스(INDEX) 개념

- 테이블 안의 데이터를 쉽고 빠르게 찾을 수 있도록 만든 데이터베이스 객체

### 1. 인덱스의 필요성

- 디스크 접근 횟수를 줄여 검색 속도를 높이기 위해 사용

## 2. 인덱스 생성

```sql
CREATE [REVERSE] [UNIQUE] INDEX [인덱스_이름]
ON 테이블_이름 ({열_이름 [ASC|DESC]}, +);
```

- `REVERSE` : 인덱스 역순 생성
- `UNIQUE` : 테이블의 열 값에 중복이 없는 유일한 인덱스 생성

## 3. 인덱스 삭제

```sql
DROP INDEX 인덱스_이름 ON 테이블_이름;
```

- 불필요한 인덱스 삭제 → 성능 저하 예방, 저장 공간 낭비 예방

## 4. 인덱스 적용 고려사항

### 1. 인덱스 생성이 필요한 경우

- 기본키, 외래키
- WHERE절 조건식에 자주 사용되는 테이블 열
- 조인 조건식에 자주 사용되는 테이블 열
- 하나의 테이블에 3~5개 정도의 인덱스
- 정수형, 고정길이 문자형 열에 인덱스 생성
- ORDER BY절이나 GROUP BY절에 자주 사용되는 열

### 2. 인덱스 생성이 불필요한 경우

- 갱신이 빈번한 테이블 열
- 집계 함수, 내장 함수를 적용하여 열 값을 변형하는 경우
- 열의 선택도가 높을 경우
- 범위 검색을 하는 경우
- 테이블의 행 개수가 별로 없는 경우